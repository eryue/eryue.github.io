---
layout: post
title: volatile
categories:
- c++
tags:
- c++
---


## volatile
volatile是个类型修饰符，volatile变量每次使用时都会重新读取内存中的值，而不是使用寄存器里的备份。

## 防止编译器的优化

```cpp
XBYTE[2]=0x55;
XBYTE[2]=0x56;
XBYTE[2]=0x57;
XBYTE[2]=0x58;
```

编译器会对以上代码进行优化，只产生一条机器代码。如果键入volatile，则编译器会逐一的进行编译并产生相应的机器代码（产生四条代码）。

## 多线程
当读取一个变量时，为提高存取速度，编译器优化时有时会先把变量读取到一个寄存器中；以后再取变量值时，就直接从寄存器中取值；
当变量值在本线程里改变时，会同时把变量的新值copy到该寄存器中，以便保持一致
当变量在因别的线程等而改变了值，该寄存器的值不会相应改变，从而造成应用程序读取的值和实际的变量值不一致。如果有volatile修饰符，则
可以避免这种情况。
